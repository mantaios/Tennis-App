<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8" />
  <title>Καταγραφή Αγώνα Τένις</title>
  <style>
    body {
      background-color: #121212;
      color: #ffffff;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      padding: 20px;
    }
    h1 {
      color: #ffc371;
      text-align: center;
      margin-bottom: 30px;
    }
    form {
      background-color: #1e1e1e;
      padding: 30px;
      border-radius: 15px;
      max-width: 600px;
      margin: 0 auto 20px auto;
    }
    label {
      display: block;
      margin-top: 15px;
      font-weight: bold;
    }
    input, select {
      width: 100%;
      padding: 10px;
      border-radius: 8px;
      border: none;
      margin-top: 5px;
      font-size: 1rem;
    }
    button {
      margin-top: 25px;
      padding: 12px 24px;
      border: none;
      border-radius: 20px;
      background-color: #ffc371;
      color: #1a1a1a;
      font-size: 1.1rem;
      font-weight: bold;
      cursor: pointer;
      width: 100%;
    }
    button:hover {
      background-color: #e6b24d;
    }
  </style>
</head>
<body>

  <h1>🎾 Δημιουργία Νέου Αγώνα</h1>
<button onclick="window.location.href='index.html'" 
        style="background-color:#ffc371; color:#1a1a1a; border:none; border-radius:20px; padding:12px 24px; font-size:1.1rem; font-weight:bold; cursor:pointer; margin-bottom:20px; display:block; width:200px; text-align:center;">
  ← Πίσω 
</button>
  <form id="matchForm">
    <label for="player1">Παίκτης 1:</label>
    <select id="player1" required></select>

    <label for="player2">Παίκτης 2:</label>
    <select id="player2" required></select>

    <label for="tournament">Όνομα Τουρνουά:</label>
    <input type="text" id="tournament" required />

    <label for="location">Τοποθεσία Αγώνα:</label>
    <input type="text" id="location" required />

    <label for="date">Ημερομηνία Αγώνα:</label>
    <input type="date" id="date" required />

    <label for="time">Ώρα Αγώνα:</label>
    <input type="time" id="time" required />
  </form>

  <!-- Μενού Κανόνες -->
  <form id="rulesForm" style="max-width: 600px; margin: 40px auto; background-color: #1e1e1e; padding: 30px; border-radius: 15px;">
    <h2 style="color: #ffc371; text-align: center; margin-bottom: 30px;">📋 Κανόνες Αγώνα</h2>

    <label for="numSets">Αριθμός Σετ:</label>
    <select id="numSets" required>
      <option value="1">1 Σετ</option>
      <option value="3" selected>3 Σετ</option>
      <option value="5">5 Σετ</option>
      <option value="7">7 Σετ</option>
    </select>

    <label for="gamesPerSet">Αριθμός Games ανά Σετ:</label>
    <select id="gamesPerSet" required>
      <option value="1">1 Game</option>
      <option value="2">2 Games</option>
      <option value="3">3 Games</option>
      <option value="4">4 Games</option>
      <option value="5">5 Games</option>
      <option value="6" selected>6 Games</option>
      <option value="7">7 Games</option>
      <option value="8">8 Games</option>
      <option value="9">9 Games</option>
      <option value="10">10 Games</option>
    </select>

    <label for="tiebreak">Tiebreak:</label>
    <select id="tiebreak" required>
      <option value="yes" selected>Ναι</option>
      <option value="no">Όχι</option>
    </select>

    <label for="courtType" style="display: block; font-weight: bold; margin-top: 25px;">Επιλογή Γηπέδου:</label>
    <div style="display: flex; align-items: center; gap: 20px; margin-top: 5px;">
      <select id="courtType" onchange="updateCourtImage()" style="width: 160px; padding: 10px; border-radius: 8px; border: none; font-size: 1rem;">
        <option value="default" selected>Γρασίδι</option>
        <option value="clay">Χώμα</option>
        <option value="blue">Σκληρό (Blue Hard)</option>
      </select>

      <div id="courtImage" style="
        width: 180px; 
        height: 120px; 
        border-radius: 12px; 
        box-shadow: 0 0 12px #000; 
        background-size: cover; 
        background-position: center;
        background-repeat: no-repeat;
      ">
      </div>
    </div>
  </form>

  <button id="startMatchBtn" style="max-width: 600px; margin: 20px auto; display: block;">🎾 Έναρξη Αγώνα</button>

  <script>
    function populateDropdowns() {
      const athletes = JSON.parse(localStorage.getItem('tennisAthletes')) || [];

      const player1Select = document.getElementById('player1');
      const player2Select = document.getElementById('player2');

      player1Select.innerHTML = '<option value="" disabled selected>Επιλέξτε Παίκτη 1</option>';
      player2Select.innerHTML = '<option value="" disabled selected>Επιλέξτε Παίκτη 2</option>';

      athletes.forEach((athlete, index) => {
        const fullName = `${athlete.firstName} ${athlete.lastName}`;
        player1Select.add(new Option(fullName, index));
        player2Select.add(new Option(fullName, index));
      });
    }

    function updateCourtImage() {
      const type = document.getElementById('courtType').value;
      const court = document.getElementById('courtImage');

      if (type === 'blue') {
        court.style.background = 'url("hard.jpg")';
        court.style.display = 'block';
      } else if (type === 'clay') {
        court.style.background = 'url("clay.jpg")';
        court.style.display = 'block';
      } else if (type === 'default') {
        court.style.background = 'url("grass.jpg")';
        court.style.display = 'block';
      } else {
        court.style.display = 'none';
        court.style.background = 'none';
      }

      court.style.backgroundSize = 'cover';
      court.style.backgroundPosition = 'center';
    }

    // Αποθήκευση όλων των δεδομένων μαζί από φόρμα
    function saveMatchData() {
      const p1Index = document.getElementById('player1').value;
      const p2Index = document.getElementById('player2').value;

      if (p1Index === p2Index) {
        alert('Οι παίκτες πρέπει να είναι διαφορετικοί!');
        return false;
      }

      const athletes = JSON.parse(localStorage.getItem('tennisAthletes')) || [];

      const matchData = {
        player1: athletes[p1Index],
        player2: athletes[p2Index],
        tournament: document.getElementById('tournament').value,
        location: document.getElementById('location').value,
        date: document.getElementById('date').value,
        time: document.getElementById('time').value,
        rules: {
          numSets: document.getElementById('numSets').value,
          gamesPerSet: document.getElementById('gamesPerSet').value,
          tiebreak: document.getElementById('tiebreak').value,
          courtType: document.getElementById('courtType').value
        },
        timestamp: new Date().toISOString()
      };

      localStorage.setItem('currentMatch', JSON.stringify(matchData));
      return true;
    }

    // Αυτο-αποθήκευση κάθε αλλαγής στη φόρμα
    function saveMatchDataFromInputs() {
      const p1Index = document.getElementById('player1').value;
      const p2Index = document.getElementById('player2').value;
      const athletes = JSON.parse(localStorage.getItem('tennisAthletes')) || [];

      const matchData = {
        player1: athletes[p1Index] || null,
        player2: athletes[p2Index] || null,
        tournament: document.getElementById('tournament').value,
        location: document.getElementById('location').value,
        date: document.getElementById('date').value,
        time: document.getElementById('time').value,
        rules: {
          numSets: document.getElementById('numSets').value,
          gamesPerSet: document.getElementById('gamesPerSet').value,
          tiebreak: document.getElementById('tiebreak').value,
          courtType: document.getElementById('courtType').value
        },
        timestamp: new Date().toISOString()
      };

      localStorage.setItem('currentMatch', JSON.stringify(matchData));
    }

    function addAutoSaveListeners() {
      const fields = [
        'player1', 'player2', 'tournament', 'location', 'date', 'time',
        'numSets', 'gamesPerSet', 'tiebreak', 'courtType'
      ];
      fields.forEach(id => {
        const el = document.getElementById(id);
        if (el) {
          el.addEventListener('change', saveMatchDataFromInputs);
          el.addEventListener('input', saveMatchDataFromInputs);
        }
      });
    }

    // Φόρτωση δεδομένων από localStorage
    function loadMatchData() {
      const stored = localStorage.getItem('currentMatch');
      if (!stored) return;

      const data = JSON.parse(stored);
      const athletes = JSON.parse(localStorage.getItem('tennisAthletes')) || [];

      if (data.player1) {
        const idx1 = athletes.findIndex(a => a.firstName === data.player1.firstName && a.lastName === data.player1.lastName);
        if (idx1 !== -1) document.getElementById('player1').value = idx1;
      }
      if (data.player2) {
        const idx2 = athletes.findIndex(a => a.firstName === data.player2.firstName && a.lastName === data.player2.lastName);
        if (idx2 !== -1) document.getElementById('player2').value = idx2;
      }
      if (data.tournament) document.getElementById('tournament').value = data.tournament;
      if (data.location) document.getElementById('location').value = data.location;
      if (data.date) document.getElementById('date').value = data.date;
     
      if (data.time) document.getElementById('time').value = data.time;

      if (data.rules) {
        if (data.rules.numSets) document.getElementById('numSets').value = data.rules.numSets;
        if (data.rules.gamesPerSet) document.getElementById('gamesPerSet').value = data.rules.gamesPerSet;
        if (data.rules.tiebreak) document.getElementById('tiebreak').value = data.rules.tiebreak;
        if (data.rules.courtType) {
          document.getElementById('courtType').value = data.rules.courtType;
          updateCourtImage();
        }
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      populateDropdowns();
      loadMatchData();
      addAutoSaveListeners();

     document.getElementById('startMatchBtn').addEventListener('click', () => {
  if (saveMatchData()) {
    window.location.href = 'scoretrack.html';  // Προσθήκη redirect
  }
});


      updateCourtImage();
    });
  </script>

</body>
</html>
